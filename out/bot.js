import{c as p}from"./chunk-VF6LVY7D.js";function d(){let l,t,e=new Promise((s,o)=>{l=s,t=o});return{resolve:l,reject:t,promise:e}}var m=Symbol("noMatch"),f=Symbol("cancel");Zilch.Bot=class v{#t;#e=null;#o=0;constructor(t){this.#t=t,this.#t.type!=="practice"&&(this.#e=this.initStockfish())}async start(){if(this.#t.type==="practice")return this;let t=performance.now();await this.#s("uci",s=>{if(s!=="uciok")return m});let e={"boss-easy":0,"boss-medium":10,"boss-hard":20}[this.#t.type];return this.#s(`setoption name Skill Level value ${e}`),this.#o+=performance.now()-t,this}static async start(t){return await new v(t).start()}async move(t){let e=performance.now(),s=t.split(" "),o=parseInt(s[s.length-1]),i=Math.max(1,60-o),n=(this.#t.timeLimit.game-this.#o)/i,r=Math.min(this.#t.timeLimit.move,n,3e3);if(this.#t.type==="practice"||r<300)return this.#r(t);this.#s(`position fen ${t}`);let a,h=this.#s(`go movetime ${r-200}`,T=>{let u=T.split(" ");return u[0]!=="bestmove"?m:(clearTimeout(a),u[1])});a=setTimeout(()=>{this.#s("stop"),a=setTimeout(()=>{h.cancel()},75)},r-150);let c=await h;return c===f&&(c=this.#r(t)),this.#o+=performance.now()-e,c}#r(t){let e=new p(t).moves();return e[Math.floor(Math.random()*e.length)]}#s(t,e){if(this.#e===null)throw new Error("Can't call send before stockfish worker is initialized.");let s=d(),o=n=>{let r=e?.(n.data);r!==m&&(this.#e?.removeEventListener("message",o),s.resolve(r))};e?this.#e.addEventListener("message",o):s.resolve(void 0),this.#e.postMessage(t);let i=s.promise;return i.cancel=()=>{s.resolve(f)},i}initStockfish(){let t=`importScripts("${ASSETS_PATH}/stockfish.js")`,e=new Blob([t],{type:"text/javascript"}),s=URL.createObjectURL(e);return new Worker(s)}};
//# sourceMappingURL=bot.js.map
